<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="google" content="notranslate" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>lylium ai â™¡</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css" rel="stylesheet"/>
  <meta name="theme-color" content="#E0BBE4" />
  <link href="https://fonts.googleapis.com/css2?family=Short+Stack&display=swap" rel="stylesheet"/>
  <link rel="icon" type="image/png" href="icon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="icon/favicon.svg" />
<link rel="shortcut icon" href="icon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="Lylium" />
<link rel="manifest" href="icon/site.webmanifest" />
</head>
<body>

  <style>
    body {
      margin: 0;
      font-family: 'Short Stack', cursive;
      background-color: #f5f0f7;
      color: #4b2f3d;
      display: flex;
      flex-direction: column;
      height: 100vh;
      transition: filter 0.6s ease, background-color 0.6s ease;
      -webkit-tap-highlight-color: transparent;
    }

    .header {
      display: flex;
      align-items: center;
      padding: 10px;
      background-color: #f5f0f7;
      border-radius: 0px 0px 20px 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .header .title {
      flex-grow: 1;
      font-size: 18px;
      font-weight: bold;
    }

    .header .icons i {
      margin-left: 15px;
      font-size: 20px;
    }

    .icon-link {
      color: inherit;
      -webkit-tap-highlight-color: transparent;
    }

    .username {
      font-weight: bold;
      font-size: 0.85em;
      color: #c07fae;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
    }

    .tag {
      margin-left: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 20px;
    }

    .tag span {
      background-color: #c07fae;
      color: #f5f0f7;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 10px;
    }

    .content {
      padding: 20px;
      padding-bottom: 100px;
      flex-grow: 1;
      overflow-y: auto;
    }

    .date {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }

    .date span {
      background-color: #c07fae;
      color: #f5f0f7;
      padding: 5px 10px;
      border-radius: 10px;
      font-size: 14px;
    }

    .message {
      display: flex;
      align-items: flex-end;
      margin-bottom: 30px;
    }

    .message img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .message .bubble {
      background-color: #e6ccf0;
      border-radius: 12px;
      padding: 10px;
      max-width: 70%;
      opacity: 0;
      animation: bubbleIn 0.3s ease forwards;
    }

    .message.right {
      justify-content: flex-end;
    }

    .message.right img {
      order: 2;
      margin-left: 10px;
      margin-right: 0;
    }

    .message.right .bubble {
      background-color: #d7a8c6;
    }

    .footer {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      background-color: #f5f0f7;
      border-radius: 30px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 600px;
      z-index: 99;
    }

    .footer i {
      font-size: 24px;
      color: #c07fae;
    }

    .footer input {
      flex-grow: 1;
      border: none;
      outline: none;
      background-color: #f5f0f7;
      font-size: 16px;
    }

    .footer .send {
      font-size: 24px;
      margin-left: 10px;
      cursor: pointer;
      color: #c07fae;
    }

    .typing-dots {
      display: inline-flex;
      gap: 4px;
      margin-top: 5px;
    }

    .typing-dots span {
      width: 6px;
      height: 6px;
      background-color: #d7a8a0;
      border-radius: 50%;
      animation: jump 0.6s infinite;
    }

    .typing-dots span:nth-child(2) {
      animation-delay: 0.1s;
    }

    .typing-dots span:nth-child(3) {
      animation-delay: 0.2s;
    }

    @keyframes jump {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-6px);
      }
    }

    @keyframes bubbleIn {
      0% {
        opacity: 0;
        transform: translateY(10px) scale(0.95);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes fadeInText {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.message .bubble .text {
  animation: fadeInText 0.6s ease-in;
}

body.grayscale-mode {
  filter: grayscale(1);
  transition: filter 0.6s;
  background-color: #ddd;
}
  </style>

  <div class="header">
    <div class="title">Lylium AI.</div>
    <div class="icons">
      <i id="theme"class="fa-solid fa-brush"></i>
      <a href="https://github.com/JustCallMeChezz" target="_blank" class="icon-link">
        <i class="fas fa-code"></i>
      </a>
    </div>
  </div>

  <div class="content">
    <div class="date">
      <span id="chat-date">today</span>
    </div>
    <div class="message">
      <img alt="chats icon" height="40" src="icon/lylium.png" width="40"/>
      <div class="bubble">
        <div class="username">Lylium<div class="tag"><span>AI</span></div></div>
        <div class="text">
          <div class="text" id="lyliumText"></div>

<script>
  const lyliumText = document.getElementById("lyliumText");
  const fullIntro = "hii! im lylium... nice to meet u... ask me anything...";
  let i = 0;
  function typeIntro() {
    if (i < fullIntro.length) {
      lyliumText.textContent += fullIntro[i++];
      setTimeout(typeIntro, 30);
    }
  }
  typeIntro();
</script>
      </div>
    </div>
  </div>

  <div class="footer">
    <i class="far fa-smile"></i>
    <input placeholder="Ask smth..." type="text" style="margin-left: 8px"/>
    <i class="fas fa-paperclip"></i>
    <i class="fas fa-paper-plane send"></i>
  </div>

  <audio id="bubble-sound" src="/lyzz/sounds/getout.mp3" preload="auto"></audio>

  <script>
  const apiConfigurations = [
    { url: 'https://api.kastg.xyz/api/ai/chatgpt', model: 'gpt-4o-mini', requiresModel: true },
    { url: 'https://api.kastg.xyz/api/ai/llama', model: 'llama-3.1-8b-turbo', requiresModel: true }
  ];

  let conversationHistory = "You are Lylium, an AI assistant created by Lily aka sleepychezz, shes ur developer that love aesthetic, soft and friendlyy, but shes introvert. only talk about ur dev if asked, mostly just being informative. always respond as an ai chatbot style, like chatgpt.";

  function constructUrlApi(conversationPrompt, config) {
    const { url, model, requiresModel } = config;
    const apiKey = 'Kastg_SXQxa10WTVsNYmwAoL4d_free';
    const fullPrompt = conversationHistory + "User: " + conversationPrompt;
    const params = new URLSearchParams({ prompt: fullPrompt, key: apiKey });
    if (requiresModel) params.append('model', model);
    return `https://api.allorigins.win/get?url=${encodeURIComponent(`${url}?${params.toString()}`)}`;
  }

  async function tryFetchFromApis(prompt) {
  for (let attempt = 0; attempt < 3; attempt++) {
    for (const config of apiConfigurations) {
      const apiUrl = constructUrlApi(prompt, config);
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();
        const response = JSON.parse(data.contents)?.result?.[0]?.response;
        if (response) {
          conversationHistory += `User: ${prompt}\nAI: ${response}\n`;
          return response;
        }
      } catch {}
    }
  }
  return null; // after 3 tries, still failed... sad...
}

  async function getImageUrl(prompt) {
    const encodedPrompt = encodeURIComponent(prompt);
    const targetUrl = `https://api.kastg.xyz/api/ai/flux?prompt=${encodedPrompt}&ratio=square&key=${apiKey}`;
    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;

    try {
        const response = await fetch(proxyUrl);
        const data = await response.json();
        const parsed = JSON.parse(data.contents);
        return parsed.result?.[0]?.url || null;
    } catch (error) {
        console.error("Image generation error:", error);
        return null;
    }
}

  function parseMarkdown(text) {
    return text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/_(.*?)_/g, '<i>$1</i>');
  }

  async function sendMessage() {
    const input = document.querySelector('.footer input');
    const messageText = input.value.trim();
    if (!messageText) return;

    const content = document.querySelector('.content');
    const userMessage = document.createElement('div');
    userMessage.className = 'message right';
    userMessage.innerHTML = `<img src="/lyzz/images/empty.png"><div class="bubble"><div class="text">${messageText}</div></div>`;
    content.appendChild(userMessage);
    input.value = '';

    const typing = document.createElement('div');
    typing.className = 'message';
    typing.innerHTML = `<img src="icon/lylium.png"><div class="bubble"><div class="username">Lylium<div class="tag"><span>AI</span></div></div><div class="text"><div class="typing-dots"><span></span><span></span><span></span></div></div></div>`;
    content.appendChild(typing);
    content.scrollTop = content.scrollHeight;

    await new Promise(r => setTimeout(r, 800));

    let reply = "";
if (messageText.startsWith('/generate')) {
  const prompt = messageText.replace('/generate', '').trim();
  const img = await getImageUrl(prompt);
  reply = img
    ? `<img src="${img}" style="max-width:300px; border-radius:10px;">`
    : "uh srry, image generator not working rn...";
} else if (messageText.startsWith('/ui')) {
  const prompt = messageText.replace('/ui', '').trim();
  const fullPrompt = `make only a <style> tag to change the css for ${prompt}`;
  const res = await tryFetchFromApis(fullPrompt);
  if (res) {
    const styleMatch = res.match(/<style[\s\S]*?<\/style>/i);
    if (styleMatch) {
      console.log(styleMatch[0]); 
      const styleEl = document.createElement('style');
styleEl.innerHTML = styleMatch[0].replace(/<style>|<\/style>/g, '');
document.head.appendChild(styleEl);
    }
  }
  reply = "done!";
} else {
      reply = await tryFetchFromApis(messageText);
      if (!reply) {
  reply = "hahh??";
  conversationHistory = ""; 
} else {
  if (messageText.split(' ').length < 20 && conversationHistory.includes("hahh??")) {
    conversationHistory = `User: ${messageText}\nAI: ${reply}\n`; 
  }
}
    }

    content.removeChild(typing);

    const botMsg = document.createElement('div');
botMsg.className = 'message';
const parsed = parseMarkdown(reply);
botMsg.innerHTML = `<img src="icon/lylium.png"><div class="bubble"><div class="username">Lylium<div class="tag"><span>AI</span></div></div><div class="text" id="aiText${Date.now()}"></div></div>`;
content.appendChild(botMsg);

const textEl = botMsg.querySelector('.text');
let idx = 0;
function typeAiReply() {
  if (idx <= parsed.length) {
    textEl.innerHTML = parsed.slice(0, idx++);
    setTimeout(typeAiReply, 2);
  }
}
typeAiReply();
    content.scrollTop = content.scrollHeight;

    const bubbleSound = document.getElementById('bubble-sound');
    bubbleSound.play();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const sendBtn = document.querySelector('.footer .send');
    const input = document.querySelector('.footer input');
    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keypress', e => { if (e.key === 'Enter') sendMessage(); });
  });

  document.addEventListener('DOMContentLoaded', (event) => {
            let dateElement = document.getElementById('chat-date');
            let today = new Date();
            let options = { month: 'long', day: 'numeric' };
            let currentDate = today.toLocaleDateString('en-US', options);
            dateElement.textContent = currentDate;
        });
</script>
<script>
  const themeBtn = document.getElementById("theme");
  themeBtn.addEventListener("click", () => {
    document.body.classList.toggle("grayscale-mode");
  });
</script>
</body>
</html>
